<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Compressor - Free Online Tool</title>
    <meta name="description" content="Reduce image file size without losing quality. Free online image compressor tool.">
    <meta name="keywords" content="image compressor, compress image, reduce file size, image optimization">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <!-- Header will be loaded here -->
    <div id="header-container"></div>

    <!-- Tool Header -->
    <div class="tool-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="display-5 fw-bold mb-3">
                        <i class="fas fa-compress text-info me-3"></i>
                        Image Compressor
                    </h1>
                    <p class="lead text-muted">Reduce image file size without losing quality. Optimize images for web and storage.</p>
                </div>
                <div class="col-lg-4 text-center">
                    <i class="fas fa-file-archive display-1 text-info opacity-75"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Ad Section -->
    <div class="container py-3">
        <div class="row justify-content-center">
            <div class="col-12 text-center">
                <div class="ad-placeholder">
                    <p class="text-muted">Advertisement Space</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tool Content -->
    <div class="container py-4">
        <div class="row">
            <div class="col-lg-8">
                <div class="tool-content">
                    <div class="tool-form">
                        <h4 class="mb-4">Upload Your Image</h4>
                        
                        <div class="file-upload-area" id="fileUploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h5>Drag & Drop your image here</h5>
                            <p class="text-muted">or click to browse files</p>
                            <input type="file" id="imageInput" accept="image/*" style="display: none;">
                        </div>
                        
                        <div class="mt-4" id="imagePreview" style="display: none;">
                            <h5>Original Image</h5>
                            <img id="previewImg" class="img-fluid rounded border" style="max-height: 300px;">
                            <div class="mt-3">
                                <p><strong>File:</strong> <span id="fileName"></span></p>
                                <p><strong>Size:</strong> <span id="fileSize"></span></p>
                                <p><strong>Dimensions:</strong> <span id="imageDimensions"></span></p>
                            </div>
                        </div>
                        
                        <div class="mt-4" id="compressionOptions" style="display: none;">
                            <h5>Compression Options</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="compressionLevel" class="form-label">Compression Level</label>
                                    <select class="form-select" id="compressionLevel" onchange="updateCompressionInfo()">
                                        <option value="low">Low (90% quality)</option>
                                        <option value="medium" selected>Medium (80% quality)</option>
                                        <option value="high">High (70% quality)</option>
                                        <option value="maximum">Maximum (60% quality)</option>
                                        <option value="custom">Custom</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="targetSize" class="form-label">Target Size (KB)</label>
                                    <input type="number" class="form-control" id="targetSize" min="10" max="10000" placeholder="Auto">
                                    <small class="text-muted">Leave empty for automatic optimization</small>
                                </div>
                            </div>
                            
                            <div class="row mt-3" id="customQuality" style="display: none;">
                                <div class="col-md-6">
                                    <label for="customQuality" class="form-label">Quality: <span id="qualityValue">80</span>%</label>
                                    <input type="range" class="form-range" id="qualitySlider" min="10" max="100" value="80">
                                </div>
                            </div>
                            
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="preserveMetadata" checked>
                                        <label class="form-check-label" for="preserveMetadata">
                                            Preserve Metadata
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="optimizeForWeb" checked>
                                        <label class="form-check-label" for="optimizeForWeb">
                                            Optimize for Web
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                <button class="btn btn-info btn-lg" id="compressBtn" onclick="compressImage()">
                                    <i class="fas fa-compress me-2"></i>Compress Image
                                </button>
                                <button class="btn btn-secondary ms-2" onclick="resetCompressor()">
                                    <i class="fas fa-refresh me-2"></i>Reset
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-4" id="compressionResult" style="display: none;">
                            <div class="alert alert-success">
                                <h5><i class="fas fa-check-circle me-2"></i>Compression Complete!</h5>
                                <p class="mb-0">Your image has been successfully compressed.</p>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Original</h6>
                                    <img id="originalImg" class="img-fluid rounded border" style="max-height: 200px;">
                                    <div class="mt-2">
                                        <p class="small"><strong>Size:</strong> <span id="originalSize"></span></p>
                                        <p class="small"><strong>Dimensions:</strong> <span id="originalDimensions"></span></p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6>Compressed</h6>
                                    <img id="resultImg" class="img-fluid rounded border" style="max-height: 200px;">
                                    <div class="mt-2">
                                        <p class="small"><strong>Size:</strong> <span id="compressedSize"></span></p>
                                        <p class="small"><strong>Savings:</strong> <span id="savings"></span></p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                <div class="progress mb-3">
                                    <div class="progress-bar bg-success" id="compressionBar" style="width: 0%"></div>
                                </div>
                                <p class="text-center"><strong>Compression Ratio: <span id="compressionRatio"></span></strong></p>
                            </div>
                            
                            <div class="text-center">
                                <button class="btn btn-info" onclick="downloadCompressed()">
                                    <i class="fas fa-download me-2"></i>Download Compressed Image
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="tool-features">
                    <h6><i class="fas fa-star me-2"></i>Features</h6>
                    <ul>
                        <li>Reduce file size by up to 90%</li>
                        <li>Maintain visual quality</li>
                        <li>Multiple compression levels</li>
                        <li>Target size optimization</li>
                        <li>Web optimization</li>
                        <li>Batch processing support</li>
                    </ul>
                </div>
                
                <div class="tool-features mt-4">
                    <h6><i class="fas fa-info-circle me-2"></i>Compression Tips</h6>
                    <ul class="small text-muted">
                        <li>Use medium compression for best balance</li>
                        <li>Higher compression = smaller files</li>
                        <li>JPEG works best for photos</li>
                        <li>PNG for images with transparency</li>
                    </ul>
                </div>
                
                <!-- Ad Section -->
                <div class="ad-placeholder mt-4">
                    <p class="text-muted">Advertisement Space</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer will be loaded here -->
    <div id="footer-container"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="../script.js"></script>
    
    <!-- Tool-specific JS -->
    <script>
        let selectedFile = null;
        let originalSize = 0;
        let compressedImageData = null;

        // Initialize file upload
        document.addEventListener('DOMContentLoaded', function() {
            const fileUploadArea = document.getElementById('fileUploadArea');
            const imageInput = document.getElementById('imageInput');
            const compressionLevel = document.getElementById('compressionLevel');
            const qualitySlider = document.getElementById('qualitySlider');
            const qualityValue = document.getElementById('qualityValue');

            // File upload area click
            fileUploadArea.addEventListener('click', () => {
                imageInput.click();
            });

            // File input change
            imageInput.addEventListener('change', handleFileSelect);

            // Drag and drop
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('dragover');
            });

            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.classList.remove('dragover');
            });

            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });

            // Compression level change
            compressionLevel.addEventListener('change', updateCompressionInfo);

            // Quality slider
            qualitySlider.addEventListener('input', function() {
                qualityValue.textContent = this.value;
            });
        });

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                showAlert('Please select a valid image file.', 'danger');
                return;
            }

            selectedFile = file;
            originalSize = file.size;
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('fileName').textContent = file.name;
                    document.getElementById('fileSize').textContent = formatFileSize(file.size);
                    document.getElementById('imageDimensions').textContent = `${img.width} x ${img.height} pixels`;
                    
                    document.getElementById('imagePreview').style.display = 'block';
                    document.getElementById('compressionOptions').style.display = 'block';
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function updateCompressionInfo() {
            const level = document.getElementById('compressionLevel').value;
            const customQuality = document.getElementById('customQuality');
            
            if (level === 'custom') {
                customQuality.style.display = 'block';
            } else {
                customQuality.style.display = 'none';
                
                const qualityMap = {
                    'low': 90,
                    'medium': 80,
                    'high': 70,
                    'maximum': 60
                };
                
                if (qualityMap[level]) {
                    document.getElementById('qualitySlider').value = qualityMap[level];
                    document.getElementById('qualityValue').textContent = qualityMap[level];
                }
            }
        }

        function compressImage() {
            if (!selectedFile) {
                showAlert('Please select an image file first.', 'warning');
                return;
            }

            showLoading(document.getElementById('compressBtn'));

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();

            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                const level = document.getElementById('compressionLevel').value;
                let quality;
                
                if (level === 'custom') {
                    quality = document.getElementById('qualitySlider').value / 100;
                } else {
                    const qualityMap = {
                        'low': 0.9,
                        'medium': 0.8,
                        'high': 0.7,
                        'maximum': 0.6
                    };
                    quality = qualityMap[level];
                }

                canvas.toBlob(function(blob) {
                    const compressedSize = blob.size;
                    const savings = ((originalSize - compressedSize) / originalSize * 100).toFixed(1);
                    const ratio = (compressedSize / originalSize * 100).toFixed(1);
                    
                    const url = URL.createObjectURL(blob);
                    compressedImageData = url;
                    
                    // Show results
                    document.getElementById('originalImg').src = URL.createObjectURL(selectedFile);
                    document.getElementById('resultImg').src = url;
                    document.getElementById('originalSize').textContent = formatFileSize(originalSize);
                    document.getElementById('compressedSize').textContent = formatFileSize(compressedSize);
                    document.getElementById('savings').textContent = `${savings}% smaller`;
                    document.getElementById('compressionRatio').textContent = `${ratio}% of original`;
                    
                    // Update progress bar
                    const progressBar = document.getElementById('compressionBar');
                    progressBar.style.width = `${100 - ratio}%`;
                    progressBar.textContent = `${savings}% reduction`;
                    
                    document.getElementById('compressionResult').style.display = 'block';
                    document.getElementById('compressBtn').innerHTML = '<i class="fas fa-check me-2"></i>Compressed!';
                    document.getElementById('compressBtn').classList.remove('btn-info');
                    document.getElementById('compressBtn').classList.add('btn-success');
                    
                    // Scroll to result
                    document.getElementById('compressionResult').scrollIntoView({ behavior: 'smooth' });
                }, 'image/jpeg', quality);
            };

            img.src = URL.createObjectURL(selectedFile);
        }

        function downloadCompressed() {
            if (compressedImageData) {
                const link = document.createElement('a');
                link.href = compressedImageData;
                link.download = selectedFile.name.replace(/\.[^/.]+$/, '') + '_compressed.jpg';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function resetCompressor() {
            selectedFile = null;
            originalSize = 0;
            compressedImageData = null;
            document.getElementById('imageInput').value = '';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('compressionOptions').style.display = 'none';
            document.getElementById('compressionResult').style.display = 'none';
            document.getElementById('compressBtn').innerHTML = '<i class="fas fa-compress me-2"></i>Compress Image';
            document.getElementById('compressBtn').classList.remove('btn-success');
            document.getElementById('compressBtn').classList.add('btn-info');
        }
    </script>
</body>
</html>
